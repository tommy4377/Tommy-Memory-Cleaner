#!/bin/sh
# Pre-commit hook for Tommy Memory Cleaner
# Runs linting and formatting checks before committing

set -e

echo "ğŸ” Running pre-commit checks..."

# Backend checks
echo "ğŸ“¦ Checking backend code..."
cd TMC/src-tauri

# Run rustfmt to check formatting
echo "  ğŸ“ Checking Rust formatting..."
if cargo fmt --all -- --check; then
    echo "  âœ… Rust code is properly formatted"
else
    echo "  âŒ Rust code is not properly formatted. Run 'cargo fmt' to fix."
    exit 1
fi

# Run clippy lints
echo "  ğŸ” Running Clippy lints..."
if cargo clippy --all-targets --all-features -- -D warnings; then
    echo "  âœ… Clippy checks passed"
else
    echo "  âŒ Clippy found issues. Please fix them before committing."
    exit 1
fi

# Frontend checks
echo "ğŸ¨ Checking frontend code..."
cd ../ui

# Run type check
echo "  ğŸ“‹ Running TypeScript type check..."
if npm run type-check; then
    echo "  âœ… TypeScript types are valid"
else
    echo "  âŒ TypeScript type errors found. Please fix them."
    exit 1
fi

# Run ESLint
echo "  ğŸ” Running ESLint..."
if npm run lint:check; then
    echo "  âœ… ESLint checks passed"
else
    echo "  âŒ ESLint found issues. Run 'npm run lint' to fix."
    exit 1
fi

# Check Prettier formatting
echo "  ğŸ“ Checking code formatting..."
if npm run format:check; then
    echo "  âœ… Code is properly formatted"
else
    echo "  âŒ Code is not properly formatted. Run 'npm run format' to fix."
    exit 1
fi

cd ../..

echo "âœ… All pre-commit checks passed!"
exit 0
